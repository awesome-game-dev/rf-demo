(this["webpackJsonprogue-flow"]=this["webpackJsonprogue-flow"]||[]).push([[1],{67:function(e,n,t){var o={"./ion-action-sheet.entry.js":[96,5],"./ion-alert.entry.js":[97,6],"./ion-app_8.entry.js":[98,7],"./ion-avatar_3.entry.js":[99,17],"./ion-back-button.entry.js":[100,18],"./ion-backdrop.entry.js":[101,43],"./ion-button_2.entry.js":[102,19],"./ion-card_5.entry.js":[103,20],"./ion-checkbox.entry.js":[104,21],"./ion-chip.entry.js":[105,22],"./ion-col_3.entry.js":[106,44],"./ion-datetime_3.entry.js":[107,10],"./ion-fab_3.entry.js":[108,23],"./ion-img.entry.js":[109,45],"./ion-infinite-scroll_2.entry.js":[110,46],"./ion-input.entry.js":[111,24],"./ion-item-option_3.entry.js":[112,25],"./ion-item_8.entry.js":[113,26],"./ion-loading.entry.js":[114,27],"./ion-menu_3.entry.js":[115,28],"./ion-modal.entry.js":[116,8],"./ion-nav_2.entry.js":[117,14],"./ion-popover.entry.js":[118,9],"./ion-progress-bar.entry.js":[119,29],"./ion-radio_2.entry.js":[120,30],"./ion-range.entry.js":[121,31],"./ion-refresher_2.entry.js":[122,11],"./ion-reorder_2.entry.js":[123,16],"./ion-ripple-effect.entry.js":[124,47],"./ion-route_4.entry.js":[125,32],"./ion-searchbar.entry.js":[126,33],"./ion-segment_2.entry.js":[127,34],"./ion-select_3.entry.js":[128,35],"./ion-slide_2.entry.js":[129,48],"./ion-spinner.entry.js":[130,13],"./ion-split-pane.entry.js":[131,49],"./ion-tab-bar_2.entry.js":[132,36],"./ion-tab_2.entry.js":[133,15],"./ion-text.entry.js":[134,37],"./ion-textarea.entry.js":[135,38],"./ion-toast.entry.js":[136,39],"./ion-toggle.entry.js":[137,12],"./ion-virtual-scroll.entry.js":[138,50]};function r(e){if(!t.o(o,e))return Promise.resolve().then((function(){var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}));var n=o[e],r=n[0];return t.e(n[1]).then((function(){return t(r)}))}r.keys=function(){return Object.keys(o)},r.id=67,e.exports=r},69:function(e,n,t){var o={"./ion-icon.entry.js":[139,57]};function r(e){if(!t.o(o,e))return Promise.resolve().then((function(){var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}));var n=o[e],r=n[0];return t.e(n[1]).then((function(){return t(r)}))}r.keys=function(){return Object.keys(o)},r.id=69,e.exports=r},80:function(e,n,t){},82:function(e,n,t){},93:function(e,n,t){},94:function(e,n,t){"use strict";t.r(n);var o,r=t(0),a=t.n(r),i=t(24),c=t.n(i),s=t(28),d=t(9),u=t(57),l=t(31),b=t(14),p=t(4),j=t(18),f=p.b.model({id:p.b.identifierNumber,nodes:p.b.late((function(){return p.b.array(p.b.reference(T))}))}).actions((function(e){return{spawnNodes:function(n){var t=n,o=Object(b.random)(3,5),r=t.spawnNodeIds(o),a=Object(j.a)(r,2),i=a[0],c=a[1],s=Object(b.range)(i,c+1),d=0;s.forEach((function(n){var r=function(e){var n=e.id,t=e.level,o=e.indexInBatch,r=e.batchSize,a=150,i=o*a+(0-(r-1)/2*a),c=-150*t;i+=Object(b.random)(-20,20),c+=Object(b.random)(-20,20);var s=function(){var e=Object(b.sample)(k);switch(e){case O.Blank:return{type:e};case O.Monster:return{type:e,power:Object(b.random)(1,5)};case O.Weapon:return{type:e,weapon:E()};case O.Potion:return{type:e,potion:h()}}}();return L.create({id:n,level:t,posX:i,posY:c,data:s})}({id:n,level:e.id,indexInBatch:d,batchSize:o});t.nodes.put(r),e.nodes.push(r),d+=1}))}}}));!function(e){e.Hearts="HEARTS",e.Healing="HEALING"}(o||(o={}));var v,g=[o.Hearts,o.Healing],m=Object.values(o),w=p.b.model({variant:p.b.enumeration("PotionVariant",m),power:p.b.number});function h(){return{variant:Object(b.sample)(g),power:Object(b.random)(1,5)}}!function(e){e.Sword="SWORD"}(v||(v={}));var O,y=[v.Sword],x=Object.values(v),N=p.b.model({variant:p.b.enumeration("WeaponVariant",x),power:p.b.number});function E(){return{variant:Object(b.sample)(y),power:Object(b.random)(1,5)}}!function(e){e.Rogue="ROGUE",e.Blank="BLANK",e.Monster="MONSTER",e.Weapon="WEAPON",e.Potion="POTION"}(O||(O={}));var k=[O.Blank,O.Monster,O.Weapon,O.Potion];var _=p.b.union(p.b.model({type:p.b.literal(O.Rogue)}),p.b.model({type:p.b.literal(O.Blank)}),p.b.model({type:p.b.literal(O.Monster),power:p.b.number}),p.b.model({type:p.b.literal(O.Weapon),weapon:N}),p.b.model({type:p.b.literal(O.Potion),potion:w}));var L=p.b.model({id:p.b.identifierNumber,level:p.b.reference(p.b.late((function(){return f}))),incomingEdgesN:0,outgoingEdgesN:0,posX:p.b.number,posY:p.b.number,data:_}).views((function(e){return{get flowClass(){return"node ".concat(e.data.type)}}})).views((function(e){return{get flowData(){return{id:"".concat(e.id),position:{x:e.posX,y:e.posY},type:"node",className:e.flowClass}}}}));var B,T=L;!function(e){e.Blank="BLANK",e.Trap="TRAP"}(B||(B={}));var S=p.b.union(p.b.model({type:p.b.literal(B.Blank)}),p.b.model({type:p.b.literal(B.Trap),power:p.b.number}));function I(){var e=Object(b.sample)([B.Blank,B.Trap]);switch(e){case B.Blank:return{type:e};case B.Trap:return{type:e,power:Object(b.random)(1,3)}}}var H=p.b.model({id:p.b.identifier,source:p.b.reference(T),target:p.b.reference(T),data:S}).views((function(e){return{get label(){switch(e.data.type){case B.Blank:return null;case B.Trap:var n,t=Object(b.sample)(["\ud83c\udf0a","\ud83e\udea4","\ud83d\udd25","\ud83c\udf2a"]);return"".concat(t).concat(null===(n=e.data)||void 0===n?void 0:n.power);default:return console.warn("CantFigureEdgeLabel",e.data),null}}}})).views((function(e){return{flowData:function(){var n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return{id:e.id,source:e.source.id.toString(),target:e.target.id.toString(),label:e.label,type:"default",animated:n}}}})),P=t(59),W=p.b.model({distance:0,hp:10,maxHp:10,weapon:p.b.maybe(N),coins:0}).views((function(e){return{get isDead(){return e.hp<=0}}})).actions((function(e){return{damage:function(n){e.hp-=n}}})).actions((function(e){return{fight:function(n){if(void 0!==e.weapon){var t=Math.min(e.weapon.power,n);if(e.weapon.power-=t,n-=t,0===e.weapon.power&&(e.weapon=void 0),0===n)return}e.damage(n)},drink:function(n){switch(n.variant){case o.Hearts:return e.maxHp+=n.power,void(e.hp+=n.power);case o.Healing:return void(e.hp=Math.min(e.hp+n.power,e.maxHp))}}}})).actions((function(e){return{reset:function(){e.distance=0,e.hp=10,e.maxHp=10,e.coins=0,e.weapon=void 0},interactWithEdge:function(n){switch(n.data.type){case B.Blank:break;case B.Trap:e.damage(n.data.power)}},interactWithNode:function(n){switch(n.data.type){case O.Blank:break;case O.Monster:e.fight(n.data.power);break;case O.Weapon:e.weapon=Object(P.a)({},n.data.weapon);break;case O.Potion:e.drink(n.data.potion);break;default:console.warn("DontKnowHowToInteractWithNode")}}}})),D=p.b.model({id:p.b.identifier,nodes:p.b.map(T),maxNodeId:-1,levels:p.b.map(f),maxLevelId:-1,edges:p.b.map(H),rogueNode:p.b.safeReference(T),rogue:W}).views((function(e){return{edgeBetweenNodes:function(n,t){for(var o=0,r=Array.from(e.edges.values());o<r.length;o++){var a=r[o];if(a.source===n&&a.target===t)return a}}}})).views((function(e){return{isReachable:function(n){var t;return(null===(t=e.rogueNode)||void 0===t?void 0:t.level).id+1===n.level.id}}})).views((function(e){return{get flowData(){var n=Array.from(e.nodes.values()).map((function(e){return e.flowData})),t=Array.from(e.edges.values()).map((function(n){return n.flowData(e.isReachable(n.target))}));return[].concat(Object(l.a)(n),Object(l.a)(t))}}})).actions((function(e){return{spawnNodeId:function(){return e.maxNodeId+=1,e.maxNodeId},spawnNodeIds:function(n){var t=e.maxNodeId+1,o=t+n-1;return e.maxNodeId=o,[t,o]},spawnEdge:function(n,t){var o="e-".concat(n,"-").concat(t),r=H.create({id:o,source:n,target:t,data:I()});e.edges.put(r),r.target.incomingEdgesN+=1,r.source.outgoingEdgesN+=1},destroyNode:function(n){n!==e.rogueNode&&(e.edges.forEach((function(t,o){if(t.source.id===n.id){var r=t.target;t.target.incomingEdgesN-=1,t.source.outgoingEdgesN-=1,e.edges.delete(o),0===r.incomingEdgesN&&e.destroyNode(r)}})),Object(b.remove)(n.level.nodes,(function(e){return e===n})),e.nodes.delete(n.id.toString()))}}})).actions((function(e){return{spawnEdgesBetween:function(n,t){var o=0,r=0,a=function(){e.spawnEdge(n.nodes[o].id,t.nodes[r].id)};for(a();;){var i=[];if(o<n.nodes.length-1&&i.push("PREV_LEVEL_STEP"),r<t.nodes.length-1&&i.push("NEXT_LEVEL_STEP"),0===i.length)break;switch(Object(b.sample)(i)){case"PREV_LEVEL_STEP":o+=1;break;case"NEXT_LEVEL_STEP":r+=1}a()}}}})).actions((function(e){return{spawnLevel:function(){var n=e.levels.get(e.maxLevelId.toString());e.maxLevelId+=1;var t=e.maxLevelId,o=f.create({id:t,nodes:[]});o.spawnNodes(e),e.levels.put(o),e.spawnEdgesBetween(n,o)}}})).actions((function(e){return{init:function(){var n=T.create({id:0,level:0,posX:0,posY:0,data:{type:O.Rogue}});e.nodes.put(n),e.levels.put(f.create({id:0,nodes:[0]})),e.rogueNode=n,e.maxLevelId=0,e.maxNodeId=0,e.spawnLevel(),e.spawnLevel(),e.spawnLevel()}}})).actions((function(e){return{reset:function(){e.levels.clear(),e.nodes.clear(),e.edges.clear(),e.maxLevelId=-1,e.maxNodeId=-1,e.rogue.reset(),e.init()}}})).actions((function(e){return{move:function(n){var t,o=null===(t=e.rogueNode)||void 0===t?void 0:t.level,r=e.edgeBetweenNodes(e.rogueNode,n);e.rogue.interactWithEdge(r),e.rogue.isDead?e.reset():(e.rogue.interactWithNode(n),e.rogue.isDead?e.reset():(n.data={type:O.Rogue},e.rogueNode=n,e.rogue.distance+=1,o.nodes.forEach((function(n){e.destroyNode(n)})),e.levels.delete(o.id.toString()),e.spawnLevel()))}}})).create({id:"land",rogueNode:0,rogue:{}});D.init(),Object(p.a)(D,(function(e){console.log("landStore.onSnapshot: ",e)}));var R=Object(r.createContext)(null);function C(){var e=Object(r.useContext)(R);if(null===e)throw new Error("Store cannot be null, please add a context provider");return e}t(80);var F=t(3),M=function(){return Object(F.jsxs)(d.e,{children:[Object(F.jsx)(d.d,{children:Object(F.jsx)(d.i,{children:Object(F.jsx)(d.h,{children:"Blank"})})}),Object(F.jsxs)(d.c,{fullscreen:!0,children:[Object(F.jsx)(d.d,{collapse:"condense",children:Object(F.jsx)(d.i,{children:Object(F.jsx)(d.h,{size:"large",children:"Blank"})})}),Object(F.jsx)(d.b,{routerLink:"/game",children:"Game"})]})]})},A=t(35),z=t(45),V=t(25),X=function(e){return Object(F.jsxs)(F.Fragment,{children:[Object(F.jsx)(V.c,{type:"target",position:V.d.Bottom}),Object(F.jsx)(V.c,{type:"source",position:V.d.Top}),Object(F.jsxs)("div",{children:[e.icon,void 0!==e.number?" ".concat(e.number):""]})]})},U=Object(r.memo)(X),Y=Object(A.a)((function(){var e=C().rogue;return Object(F.jsxs)(F.Fragment,{children:[Object(F.jsxs)("div",{children:["\u2764\ufe0f",e.hp,"/",e.maxHp,Object(F.jsx)("span",{children:" "}),void 0!==e.weapon?"\u2694\ufe0f".concat(e.weapon.power):"\u270a"]}),Object(F.jsx)(V.c,{type:"source",position:V.d.Top})]})})),K=function(e){var n=C().nodes.get(e.id);if(void 0===n)return null;switch(n.data.type){case O.Rogue:return Object(F.jsx)(Y,{});case O.Blank:return Object(F.jsx)(U,{icon:"\u26fa\ufe0f"});case O.Monster:return Object(F.jsx)(U,{icon:"\ud83d\udc7e",number:n.data.power});case O.Weapon:return Object(F.jsx)(U,{icon:"\u2694\ufe0f",number:n.data.weapon.power});case O.Potion:switch(n.data.potion.variant){case o.Hearts:return Object(F.jsx)(U,{icon:"\ud83d\udc95",number:n.data.potion.power});case o.Healing:return Object(F.jsx)(U,{icon:"\ud83e\uddea",number:n.data.potion.power})}break;default:return console.warn("DontKnowHowToRenderNode",JSON.stringify(n.data)),Object(F.jsx)(F.Fragment,{})}},G=Object(A.a)((function(){var e=C().rogue;return Object(F.jsxs)("div",{id:"coins-label",children:["coins ",e.coins,Object(F.jsx)("br",{}),"distance ",e.distance]})}));t(82);function J(){return{innerHeight:window.innerHeight,innerWidth:window.innerWidth,outerHeight:window.outerHeight,outerWidth:window.outerWidth}}var q=function(){var e=Object(r.useState)(J()),n=Object(j.a)(e,2),t=n[0],o=n[1];function a(){o(J())}return Object(r.useEffect)((function(){return window.addEventListener("resize",a),function(){window.removeEventListener("resize",a)}}),[]),t},Q=z.a.Quadratic.Out;requestAnimationFrame((function e(n){requestAnimationFrame(e),z.c.update(n)}));var $=Object(A.a)((function(){var e=q(),n=e.innerWidth/2,t=e.innerHeight/3*2,o=C(),a=o.flowData,i=Object(r.useState)(null),c=Object(j.a)(i,2),s=c[0],u=c[1],l=Object(r.useCallback)((function(e){u(e),e.fitView(),b(e)}),[]),b=function(e){!function(e,o){var r=e.toObject(),a=Object(j.a)(r.position,2),i=a[0],c=a[1],s=r.zoom,d=0-o.posX+n,u=0-o.posY+t;new z.b({x:i,y:c,zoom:s}).to({x:d,y:u,zoom:1},300).easing(Q).onUpdate((function(n){var t=n.x,o=n.y,r=n.zoom;e.setTransform({x:t,y:o,zoom:r})})).start()}(e,o.rogueNode)};return Object(F.jsx)(d.e,{children:Object(F.jsxs)(d.c,{fullscreen:!0,children:[Object(F.jsx)(V.e,{nodeTypes:{node:K},elements:a,elementsSelectable:!1,nodesDraggable:!1,nodesConnectable:!1,onLoad:l,onElementClick:function(e,n){if(function(e){return e.position}(n)){var t=o.nodes.get(n.id);o.isReachable(t)&&(o.move(t),b(s))}},children:Object(F.jsx)(V.a,{variant:V.b.Lines})}),Object(F.jsx)(G,{})]})})})),Z=(t(83),t(84),t(85),t(86),t(87),t(88),t(89),t(90),t(91),t(92),t(93),function(){return Object(F.jsx)(d.a,{children:Object(F.jsx)(R.Provider,{value:D,children:Object(F.jsx)(u.a,{children:Object(F.jsxs)(d.g,{children:[Object(F.jsx)(s.b,{path:"/game",component:$,exact:!0}),Object(F.jsx)(s.b,{path:"/home",component:M,exact:!0}),Object(F.jsx)(s.a,{from:"/",to:"/home",exact:!0})]})})})})});Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var ee=function(e){null!=e&&e instanceof Function&&t.e(58).then(t.bind(null,156)).then((function(n){var t=n.getCLS,o=n.getFID,r=n.getFCP,a=n.getLCP,i=n.getTTFB;t(e),o(e),r(e),a(e),i(e)}))};c.a.render(Object(F.jsx)(a.a.StrictMode,{children:Object(F.jsx)(Z,{})}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)})),ee()}},[[94,3,4]]]);
//# sourceMappingURL=main.f822c32d.chunk.js.map